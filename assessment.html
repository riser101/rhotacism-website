<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free R-Sound Assessment - The Rollr Academy</title>
    <link rel="icon" type="image/jpeg" href="instagram-icon.jpg">
    <link rel="apple-touch-icon" href="instagram-icon.jpg">
    <meta name="description" content="Take your free 2-minute R-sound assessment. Get personalized results and discover exactly what's blocking your perfect R pronunciation.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-584ZMQTPSE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-584ZMQTPSE');
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-weight: 400;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Navigation */
        .navbar {
            background: linear-gradient(to bottom, #000000 0%, #1a1a1a 50%, #000000 100%);
            padding: 20px 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            font-family: 'Quicksand', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: white;
            text-decoration: none;
        }

        /* Assessment Page Styles */
        .assessment-page {
            background: linear-gradient(to bottom, #000000 0%, #0A0A0A 12%, #1A1A1A 20%, #2D2D00 30%, #4A4A00 40%, #666600 47%, #D4911A 53%, #E6A91F 57%, #F5B532 61%, #FF9800 67%, #FF8F00 73%, #FF6F00 80%, #E65100 87%, #BF360C 92%, #8D2F00 96%, #000000 100%);
            min-height: 100vh;
            padding-top: 100px;
            padding-bottom: 60px;
        }

        .assessment-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .assessment-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .assessment-title {
            font-family: 'Quicksand', sans-serif;
            font-size: 42px;
            font-weight: 700;
            color: white;
            margin-bottom: 16px;
            line-height: 1.2;
        }

        .assessment-subtitle {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
        }

        .assessment-tagline {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
        }

        /* Progress Bar */
        .progress-container {
            margin: 40px 0;
        }

        .progress-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            margin-bottom: 8px;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF9800, #E65100);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Assessment Steps */
        .assessment-step {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }

        .assessment-step.active {
            display: block;
        }

        .step-title {
            font-family: 'Quicksand', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .step-content {
            margin-bottom: 30px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #FF9800;
        }
        
        /* Phone Input Styles */
        .phone-input-container {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .country-select {
            min-width: 120px;
            padding: 16px 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }
        
        .country-select:focus {
            outline: none;
            border-color: #FF9800;
        }
        
        .phone-input {
            flex: 1;
        }
        
        #otherReasonGroup {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #FF9800;
        }

        .form-help {
            font-size: 14px;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }

        /* Radio and Checkbox Options */
        .options-group {
            margin: 20px 0;
        }

        .option-item {
            margin-bottom: 12px;
            cursor: pointer;
        }

        .option-item input[type="radio"],
        .option-item input[type="checkbox"] {
            margin-right: 12px;
            transform: scale(1.2);
        }

        .option-item label {
            cursor: pointer;
            font-size: 16px;
            line-height: 1.4;
        }

        /* Recording Section */
        .recording-section {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #FF9800;
        }

        .words-to-say {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #FF9800;
        }

        .record-button {
            background: #000000;
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 20px 0;
        }

        .record-button:hover {
            background: #333333;
        }

        .recording-status {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            font-weight: 500;
        }
        
        .recording-status.error {
            color: #dc3545;
            background: #fff5f5;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #f5c6cb;
        }
        
        .recording-status.success {
            color: #28a745;
            background: #f8fff9;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #c3e6cb;
        }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 16px;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #000000;
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            background: #333333;
        }

        .btn-secondary {
            background: transparent;
            color: #666;
            border: 2px solid #e9ecef;
        }

        .btn-secondary:hover {
            border-color: #FF9800;
            color: #FF9800;
        }

        /* Security Badge */
        .security-badge {
            text-align: center;
            margin-top: 20px;
            padding: 12px;
            background: rgba(40, 167, 69, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(40, 167, 69, 0.2);
        }

        .security-badge .icon {
            font-size: 18px;
            margin-right: 8px;
        }

        .security-text {
            font-size: 14px;
            color: #28a745;
            font-weight: 600;
        }

        /* Loading Screen */
        .loading-screen {
            text-align: center;
            padding: 60px 40px;
        }

        .loading-title {
            font-family: 'Quicksand', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
        }

        .loading-animation {
            margin: 30px 0;
        }

        .loading-dots {
            display: inline-block;
            margin: 0 4px;
            animation: loadingDots 1.4s infinite ease-in-out;
        }

        .loading-dots:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots:nth-child(2) { animation-delay: -0.16s; }

        @keyframes loadingDots {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .loading-steps {
            text-align: left;
            max-width: 400px;
            margin: 0 auto;
        }

        .loading-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            font-size: 16px;
            color: #666;
        }

        .loading-step.completed {
            color: #28a745;
        }

        .loading-step .icon {
            margin-right: 12px;
            width: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .assessment-title {
                font-size: 32px;
            }

            .assessment-subtitle {
                font-size: 18px;
            }

            .assessment-step {
                padding: 30px 20px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .assessment-title {
                font-size: 28px;
            }

            .assessment-container {
                padding: 0 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">The Rollr Academy</a>
        </div>
    </nav>

    <!-- Assessment Page -->
    <div class="assessment-page">
        <div class="assessment-container">
            <div class="assessment-header">
                <h1 class="assessment-title">Your Free R-Sound Assessment</h1>
                <p class="assessment-subtitle">See exactly where your R sound needs work</p>
                <p class="assessment-tagline">(This takes just 2 minutes)</p>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-label">Step <span id="currentStep">1</span> of 5</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 20%"></div>
                </div>
            </div>

            <!-- Step 1: Email Capture -->
            <div class="assessment-step active" id="step1">
                <h2 class="step-title">Step 1: Basic Information</h2>
                <div class="step-content">
                    <div class="form-group">
                        <label class="form-label" for="email">Email Address:</label>
                        <input type="email" id="email" class="form-input" placeholder="your.email@example.com" required>
                        <div class="form-help">
                            Why? We'll send your personalized results + a custom practice plan
                        </div>
                    </div>
                </div>
                <div class="btn-group">
                    <div></div>
                    <button class="btn btn-primary" onclick="nextStep()">Continue to Assessment →</button>
                </div>
                <div class="security-badge">
                    <span class="icon">🔒</span>
                    <span class="security-text">Your information is 100% confidential</span>
                </div>
            </div>

            <!-- Step 2: Voice Recording -->
            <div class="assessment-step" id="step2">
                <h2 class="step-title">Step 2: Voice Recording + Analysis</h2>
                <div class="step-content">
                    <div class="recording-section">
                        <p style="font-size: 18px; margin-bottom: 20px;">📱 Record Yourself Saying These Words</p>
                        <p>Click 'Record' and clearly say each word:</p>
                        <div class="words-to-say">
                            red, car, tree, around, forest, problem, girl, world
                        </div>
                        <button class="record-button" id="recordBtn" onclick="toggleRecording()">🎤 Click to Record</button>
                        <div class="recording-status" id="recordingStatus">Recording time: 0:00</div>
                        <p style="font-size: 14px; color: #666; margin-top: 15px;">
                            Don't worry - only you will hear this recording.<br>
                            Our speech algorithm analyzes patterns, not the actual audio.
                        </p>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
                    <button class="btn btn-primary" onclick="nextStep()" id="step2Continue" disabled>Continue →</button>
                </div>
            </div>

            <!-- Step 3: Self-Assessment Questions -->
            <div class="assessment-step" id="step3">
                <div class="step-content">
                    <div class="form-group">
                        <label class="form-label">How would you describe your comfort level with making the 'R' sound?</label>
                        <div class="options-group">
                            <div class="option-item">
                                <input type="radio" id="trouble1" name="troubleWords" value="slight">
                                <label for="trouble1">I have slight trouble with R sounds</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="trouble2" name="troubleWords" value="noticeable">
                                <label for="trouble2">I have noticeable difficulty with R sounds</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="trouble3" name="troubleWords" value="significant">
                                <label for="trouble3">I have significant trouble pronouncing R sounds</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="trouble4" name="troubleWords" value="no_trouble">
                                <label for="trouble4">I don't have trouble with R sounds</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="trouble5" name="troubleWords" value="unsure">
                                <label for="trouble5">Not sure/want assessment</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">What's your age group?</label>
                        <div class="options-group">
                            <div class="option-item">
                                <input type="radio" id="age1" name="ageGroup" value="teen">
                                <label for="age1">Teen (13-17 years)</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="age2" name="ageGroup" value="young_adult">
                                <label for="age2">Young Adult (18-25 years)</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="age3" name="ageGroup" value="adult">
                                <label for="age3">Adult (26-54 years)</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="age4" name="ageGroup" value="senior_adult">
                                <label for="age4">Adult (55+ years)</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
                    <button class="btn btn-primary" onclick="nextStep()" id="step3Continue" disabled>Continue →</button>
                </div>
            </div>

            <!-- Step 4: Visit Reason -->
            <div class="assessment-step" id="step4">
                <div class="step-content">
                    <div class="form-group">
                        <label class="form-label">How did you learn about Rollr Academy?</label>
                        <div class="options-group">
                            <div class="option-item">
                                <input type="radio" id="reason5" name="visitReason" value="google_ad">
                                <label for="reason5">Via Google search ad</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="reason6" name="visitReason" value="social_media">
                                <label for="reason6">Via Google search results</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="reason7" name="visitReason" value="google_search">
                                <label for="reason7">Via Instagram</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="reason8" name="visitReason" value="reddit_community">
                                <label for="reason8">Via Reddit Community</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="reason9" name="visitReason" value="other">
                                <label for="reason9">Other</label>
                            </div>
                        </div>
                        <div class="form-group" id="otherReasonGroup" style="display: none;">
                            <label class="form-label" for="otherReason">Please specify:</label>
                            <input type="text" id="otherReason" class="form-input" placeholder="Please tell us how you found us...">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="phoneNumber">Phone Number (Optional):</label>
                        <div class="phone-input-container">
                            <select id="countryCode" class="country-select">
                                <option value="+1" data-flag="🇺🇸">🇺🇸 +1</option>
                                <option value="+44" data-flag="🇬🇧">🇬🇧 +44</option>
                                <option value="+61" data-flag="🇦🇺">🇦🇺 +61</option>
                                <option value="+1" data-flag="🇨🇦">🇨🇦 +1</option>
                                <option value="+49" data-flag="🇩🇪">🇩🇪 +49</option>
                                <option value="+33" data-flag="🇫🇷">🇫🇷 +33</option>
                                <option value="+39" data-flag="🇮🇹">🇮🇹 +39</option>
                                <option value="+34" data-flag="🇪🇸">🇪🇸 +34</option>
                                <option value="+31" data-flag="🇳🇱">🇳🇱 +31</option>
                                <option value="+46" data-flag="🇸🇪">🇸🇪 +46</option>
                                <option value="+47" data-flag="🇳🇴">🇳🇴 +47</option>
                                <option value="+45" data-flag="🇩🇰">🇩🇰 +45</option>
                                <option value="+41" data-flag="🇨🇭">🇨🇭 +41</option>
                                <option value="+43" data-flag="🇦🇹">🇦🇹 +43</option>
                                <option value="+32" data-flag="🇧🇪">🇧🇪 +32</option>
                                <option value="+353" data-flag="🇮🇪">🇮🇪 +353</option>
                                <option value="+351" data-flag="🇵🇹">🇵🇹 +351</option>
                                <option value="+30" data-flag="🇬🇷">🇬🇷 +30</option>
                                <option value="+358" data-flag="🇫🇮">🇫🇮 +358</option>
                                <option value="+48" data-flag="🇵🇱">🇵🇱 +48</option>
                                <option value="+420" data-flag="🇨🇿">🇨🇿 +420</option>
                                <option value="+36" data-flag="🇭🇺">🇭🇺 +36</option>
                                <option value="+421" data-flag="🇸🇰">🇸🇰 +421</option>
                                <option value="+386" data-flag="🇸🇮">🇸🇮 +386</option>
                                <option value="+385" data-flag="🇭🇷">🇭🇷 +385</option>
                                <option value="+381" data-flag="🇷🇸">🇷🇸 +381</option>
                                <option value="+382" data-flag="🇲🇪">🇲🇪 +382</option>
                                <option value="+387" data-flag="🇧🇦">🇧🇦 +387</option>
                                <option value="+389" data-flag="🇲🇰">🇲🇰 +389</option>
                                <option value="+355" data-flag="🇦🇱">🇦🇱 +355</option>
                                <option value="+356" data-flag="🇲🇹">🇲🇹 +356</option>
                                <option value="+357" data-flag="🇨🇾">🇨🇾 +357</option>
                                <option value="+370" data-flag="🇱🇹">🇱🇹 +370</option>
                                <option value="+371" data-flag="🇱🇻">🇱🇻 +371</option>
                                <option value="+372" data-flag="🇪🇪">🇪🇪 +372</option>
                                <option value="+7" data-flag="🇷🇺">🇷🇺 +7</option>
                                <option value="+380" data-flag="🇺🇦">🇺🇦 +380</option>
                                <option value="+375" data-flag="🇧🇾">🇧🇾 +375</option>
                                <option value="+373" data-flag="🇲🇩">🇲🇩 +373</option>
                                <option value="+374" data-flag="🇦🇲">🇦🇲 +374</option>
                                <option value="+995" data-flag="🇬🇪">🇬🇪 +995</option>
                                <option value="+994" data-flag="🇦🇿">🇦🇿 +994</option>
                                <option value="+998" data-flag="🇺🇿">🇺🇿 +998</option>
                                <option value="+996" data-flag="🇰🇬">🇰🇬 +996</option>
                                <option value="+992" data-flag="🇹🇯">🇹🇯 +992</option>
                                <option value="+993" data-flag="🇹🇲">🇹🇲 +993</option>
                                <option value="+7" data-flag="🇰🇿">🇰🇿 +7</option>
                                <option value="+81" data-flag="🇯🇵">🇯🇵 +81</option>
                                <option value="+82" data-flag="🇰🇷">🇰🇷 +82</option>
                                <option value="+86" data-flag="🇨🇳">🇨🇳 +86</option>
                                <option value="+91" data-flag="🇮🇳">🇮🇳 +91</option>
                                <option value="+62" data-flag="🇮🇩">🇮🇩 +62</option>
                                <option value="+60" data-flag="🇲🇾">🇲🇾 +60</option>
                                <option value="+65" data-flag="🇸🇬">🇸🇬 +65</option>
                                <option value="+66" data-flag="🇹🇭">🇹🇭 +66</option>
                                <option value="+84" data-flag="🇻🇳">🇻🇳 +84</option>
                                <option value="+63" data-flag="🇵🇭">🇵🇭 +63</option>
                                <option value="+852" data-flag="🇭🇰">🇭🇰 +852</option>
                                <option value="+853" data-flag="🇲🇴">🇲🇴 +853</option>
                                <option value="+886" data-flag="🇹🇼">🇹🇼 +886</option>
                                <option value="+55" data-flag="🇧🇷">🇧🇷 +55</option>
                                <option value="+54" data-flag="🇦🇷">🇦🇷 +54</option>
                                <option value="+56" data-flag="🇨🇱">🇨🇱 +56</option>
                                <option value="+57" data-flag="🇨🇴">🇨🇴 +57</option>
                                <option value="+58" data-flag="🇻🇪">🇻🇪 +58</option>
                                <option value="+51" data-flag="🇵🇪">🇵🇪 +51</option>
                                <option value="+593" data-flag="🇪🇨">🇪🇨 +593</option>
                                <option value="+591" data-flag="🇧🇴">🇧🇴 +591</option>
                                <option value="+595" data-flag="🇵🇾">🇵🇾 +595</option>
                                <option value="+598" data-flag="🇺🇾">🇺🇾 +598</option>
                                <option value="+597" data-flag="🇸🇷">🇸🇷 +597</option>
                                <option value="+594" data-flag="🇬🇫">🇬🇫 +594</option>
                                <option value="+592" data-flag="🇬🇾">🇬🇾 +592</option>
                                <option value="+27" data-flag="🇿🇦">🇿🇦 +27</option>
                                <option value="+20" data-flag="🇪🇬">🇪🇬 +20</option>
                                <option value="+212" data-flag="🇲🇦">🇲🇦 +212</option>
                                <option value="+216" data-flag="🇹🇳">🇹🇳 +216</option>
                                <option value="+218" data-flag="🇱🇾">🇱🇾 +218</option>
                                <option value="+213" data-flag="🇩🇿">🇩🇿 +213</option>
                                <option value="+234" data-flag="🇳🇬">🇳🇬 +234</option>
                                <option value="+254" data-flag="🇰🇪">🇰🇪 +254</option>
                                <option value="+256" data-flag="🇺🇬">🇺🇬 +256</option>
                                <option value="+255" data-flag="🇹🇿">🇹🇿 +255</option>
                                <option value="+250" data-flag="🇷🇼">🇷🇼 +250</option>
                                <option value="+251" data-flag="🇪🇹">🇪🇹 +251</option>
                                <option value="+233" data-flag="🇬🇭">🇬🇭 +233</option>
                                <option value="+225" data-flag="🇨🇮">🇨🇮 +225</option>
                                <option value="+221" data-flag="🇸🇳">🇸🇳 +221</option>
                                <option value="+223" data-flag="🇲🇱">🇲🇱 +223</option>
                                <option value="+226" data-flag="🇧🇫">🇧🇫 +226</option>
                                <option value="+227" data-flag="🇳🇪">🇳🇪 +227</option>
                                <option value="+228" data-flag="🇹🇬">🇹🇬 +228</option>
                                <option value="+229" data-flag="🇧🇯">🇧🇯 +229</option>
                                <option value="+230" data-flag="🇲🇺">🇲🇺 +230</option>
                                <option value="+231" data-flag="🇱🇷">🇱🇷 +231</option>
                                <option value="+232" data-flag="🇸🇱">🇸🇱 +232</option>
                                <option value="+235" data-flag="🇹🇩">🇹🇩 +235</option>
                                <option value="+236" data-flag="🇨🇫">🇨🇫 +236</option>
                                <option value="+237" data-flag="🇨🇲">🇨🇲 +237</option>
                                <option value="+238" data-flag="🇨🇻">🇨🇻 +238</option>
                                <option value="+239" data-flag="🇸🇹">🇸🇹 +239</option>
                                <option value="+240" data-flag="🇬🇶">🇬🇶 +240</option>
                                <option value="+241" data-flag="🇬🇦">🇬🇦 +241</option>
                                <option value="+242" data-flag="🇨🇬">🇨🇬 +242</option>
                                <option value="+243" data-flag="🇨🇩">🇨🇩 +243</option>
                                <option value="+244" data-flag="🇦🇴">🇦🇴 +244</option>
                                <option value="+245" data-flag="🇬🇼">🇬🇼 +245</option>
                                <option value="+246" data-flag="🇮🇴">🇮🇴 +246</option>
                                <option value="+247" data-flag="🇦🇨">🇦🇨 +247</option>
                                <option value="+248" data-flag="🇸🇨">🇸🇨 +248</option>
                                <option value="+249" data-flag="🇸🇩">🇸🇩 +249</option>
                                <option value="+252" data-flag="🇸🇴">🇸🇴 +252</option>
                                <option value="+253" data-flag="🇩🇯">🇩🇯 +253</option>
                                <option value="+257" data-flag="🇧🇮">🇧🇮 +257</option>
                                <option value="+258" data-flag="🇲🇿">🇲🇿 +258</option>
                                <option value="+260" data-flag="🇿🇲">🇿🇲 +260</option>
                                <option value="+261" data-flag="🇲🇬">🇲🇬 +261</option>
                                <option value="+262" data-flag="🇾🇹">🇾🇹 +262</option>
                                <option value="+263" data-flag="🇿🇼">🇿🇼 +263</option>
                                <option value="+264" data-flag="🇳🇦">🇳🇦 +264</option>
                                <option value="+265" data-flag="🇲🇼">🇲🇼 +265</option>
                                <option value="+266" data-flag="🇱🇸">🇱🇸 +266</option>
                                <option value="+267" data-flag="🇧🇼">🇧🇼 +267</option>
                                <option value="+268" data-flag="🇸🇿">🇸🇿 +268</option>
                                <option value="+269" data-flag="🇰🇲">🇰🇲 +269</option>
                            </select>
                            <input type="tel" id="phoneNumber" class="form-input phone-input" placeholder="(000) 000-0000">
                        </div>
                        <div class="form-help">
                            We may send you text reminders about your practice sessions (optional)
                        </div>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
                    <button class="btn btn-primary" onclick="nextStep()" id="step4Continue" disabled>Continue →</button>
                </div>
            </div>

            <!-- Step 5: Processing Screen -->
            <div class="assessment-step" id="step5">
                <div class="loading-screen">
                    <h2 class="loading-title">🔬 Analyzing Your R Sound Patterns<span class="loading-dots">.</span><span class="loading-dots">.</span><span class="loading-dots">.</span></h2>
                    
                    <div class="loading-steps">
                        <div class="loading-step completed" id="loading1">
                            <span class="icon">⚡</span>
                            <span>Identifying substitution patterns...</span>
                        </div>
                        <div class="loading-step" id="loading2">
                            <span class="icon">🎯</span>
                            <span>Calculating tongue placement corrections...</span>
                        </div>
                        <div class="loading-step" id="loading3">
                            <span class="icon">📊</span>
                            <span>Generating your custom 12-week roadmap...</span>
                        </div>
                    </div>
                    
                    <p style="margin-top: 30px; color: #666; font-style: italic;">
                        Your results will appear in <span id="countdown">5</span>... 
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStepNum = 1;
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let recordingTimer;
        let recordingTime = 0;
        let audioBlob = null;
        let hasValidAudio = false;

        // Update progress bar
        function updateProgress() {
            const progress = (currentStepNum / 5) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('currentStep').textContent = currentStepNum;
        }

        // Next step function
        async function nextStep() {
            const continueBtn = document.querySelector(`#step${currentStepNum} .btn-primary`);
            const originalText = continueBtn.textContent;
            
            // Prevent double-clicking by immediately disabling the button
            if (continueBtn.disabled) {
                return;
            }
            continueBtn.disabled = true;
            
            // Show loading state with appropriate text
            if (currentStepNum === 1) {
                continueBtn.textContent = 'Loading...';
            } else if (currentStepNum === 3) {
                continueBtn.textContent = 'Saving...';
            } else if (currentStepNum === 4) {
                continueBtn.textContent = 'Processing...';
            } else {
                continueBtn.textContent = 'Loading...';
            }
            
            if (await validateCurrentStep()) {
                document.getElementById(`step${currentStepNum}`).classList.remove('active');
                currentStepNum++;
                
                if (currentStepNum <= 5) {
                    document.getElementById(`step${currentStepNum}`).classList.add('active');
                    updateProgress();
                    
                    if (currentStepNum === 5) {
                        startProcessing();
                    } else {
                        // Re-enable button for next step
                        const nextBtn = document.querySelector(`#step${currentStepNum} .btn-primary`);
                        if (nextBtn) {
                            nextBtn.disabled = false;
                        }
                    }
                }
            } else {
                // Reset button if validation failed
                continueBtn.textContent = originalText;
                continueBtn.disabled = false;
            }
        }

        // Previous step function
        function prevStep() {
            if (currentStepNum > 1) {
                document.getElementById(`step${currentStepNum}`).classList.remove('active');
                currentStepNum--;
                document.getElementById(`step${currentStepNum}`).classList.add('active');
                updateProgress();
            }
        }

        // Register email with Formspree
        async function registerEmail(email) {
            try {
                // Store email for later use
                localStorage.setItem('assessmentUserEmail', email);
                
                // Extract name from email for personalization
                const name = email.split('@')[0].charAt(0).toUpperCase() + email.split('@')[0].slice(1);
                localStorage.setItem('assessmentUserName', name);
                
                // Submit to FormEasy with timeout
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 2000); // 2 second timeout
                
                await fetch('https://script.google.com/macros/s/AKfycbzKixpKPkJRuqIKj7p53JSholkMjkcvWrdlLh9Vv9kl1sX6wquSIdiTUqHg1NIG6GwkTA/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        email: email,
                        source: 'assessment_step1',
                        message: 'User started R-sound assessment',
                        timestamp: new Date().toISOString(),
                        page: 'assessment.html'
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                // Track email capture event
                gtag('event', 'email_capture', {
                    event_category: 'conversion',
                    event_label: 'assessment_step1'
                });
                
                console.log('Email registered successfully');
            } catch (error) {
                console.error('Error registering email:', error);
                // Don't block the user if email registration fails
            }
        }

        // Submit Step 3 responses to FormEasy
        async function submitStep3ToFormEasy(comfortLevel, ageGroup) {
            try {
                const email = localStorage.getItem('assessmentUserEmail');
                
                // Add timeout to prevent slow loading
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000); // 3 second timeout
                
                await fetch('https://script.google.com/macros/s/AKfycbzKixpKPkJRuqIKj7p53JSholkMjkcvWrdlLh9Vv9kl1sX6wquSIdiTUqHg1NIG6GwkTA/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        email: email,
                        source: 'assessment_step3',
                        message: `Step 3: Trouble words response - ${comfortLevel}, Age group - ${ageGroup}`,
                        trouble_words_response: comfortLevel,
                        age_group: ageGroup,
                        step: 'step3',
                        timestamp: new Date().toISOString(),
                        page: 'assessment.html'
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                // Track step 3 completion
                gtag('event', 'assessment_step3_complete', {
                    event_category: 'assessment',
                    event_label: 'comfort_level_and_age_questions'
                });
                
                console.log('Step 3 responses submitted successfully');
            } catch (error) {
                console.error('Error submitting Step 3 responses:', error);
                // Don't block the user if submission fails
            }
        }

        // Submit Step 4 responses to FormEasy
        async function submitStep4ToFormEasy(visitReason, otherReasonText = '', phoneNumber = '', countryCode = '') {
            try {
                const email = localStorage.getItem('assessmentUserEmail');
                const finalReason = visitReason === 'other' ? otherReasonText : visitReason;
                const fullPhoneNumber = phoneNumber && countryCode ? `${countryCode} ${phoneNumber}` : '';
                
                // Add timeout to prevent slow loading
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000); // 3 second timeout
                
                await fetch('https://script.google.com/macros/s/AKfycbzKixpKPkJRuqIKj7p53JSholkMjkcvWrdlLh9Vv9kl1sX6wquSIdiTUqHg1NIG6GwkTA/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        email: email,
                        source: 'assessment_step4',
                        message: `Step 4: Found on - ${finalReason}${fullPhoneNumber ? `, Phone - ${fullPhoneNumber}` : ''}`,
                        found_on: finalReason,
                        found_on_type: visitReason,
                        other_reason_text: otherReasonText,
                        phone_number: fullPhoneNumber,
                        country_code: countryCode,
                        phone_number_raw: phoneNumber,
                        step: 'step4',
                        timestamp: new Date().toISOString(),
                        page: 'assessment.html'
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                // Track step 4 completion
                gtag('event', 'assessment_step4_complete', {
                    event_category: 'assessment',
                    event_label: 'found_on_and_phone_questions'
                });
                
                console.log('Step 4 responses submitted successfully');
            } catch (error) {
                console.error('Error submitting Step 4 responses:', error);
                // Don't block the user if submission fails
            }
        }

        // Validate current step
        async function validateCurrentStep() {
            switch(currentStepNum) {
                case 1:
                    const email = document.getElementById('email').value;
                    if (!email || !email.includes('@')) {
                        alert('Please enter a valid email address.');
                        return false;
                    }
                    // Register email with FormEasy (non-blocking)
                    registerEmail(email); // Remove await to make it non-blocking
                    return true;
                
                case 2:
                    if (!hasValidAudio) {
                        alert('Please record yourself saying the words clearly. Make sure to speak for at least 3 seconds.');
                        return false;
                    }
                    return true;
                
                case 3:
                    const troubleWords = document.querySelector('input[name="troubleWords"]:checked');
                    const ageGroup = document.querySelector('input[name="ageGroup"]:checked');
                    
                    if (!troubleWords) {
                        alert('Please answer the R sound comfort level question.');
                        return false;
                    }
                    
                    if (!ageGroup) {
                        alert('Please select your age group.');
                        return false;
                    }
                    
                    // Submit Step 3 responses to FormEasy
                    await submitStep3ToFormEasy(troubleWords.value, ageGroup.value);
                    
                    document.getElementById('step3Continue').disabled = false;
                    return true;
                
                case 4:
                    const visitReason = document.querySelector('input[name="visitReason"]:checked');
                    
                    if (!visitReason) {
                        alert('Please answer how you found us.');
                        return false;
                    }
                    
                    // Get phone number fields (optional)
                    const phoneNumber = document.getElementById('phoneNumber').value.trim();
                    const countryCode = document.getElementById('countryCode').value;
                    
                    // Check if 'other' is selected and input is provided
                    if (visitReason.value === 'other') {
                        const otherReasonText = document.getElementById('otherReason').value.trim();
                        if (!otherReasonText) {
                            alert('Please specify how you found us.');
                            return false;
                        }
                        // Submit Step 4 responses to FormEasy with other text and phone
                        await submitStep4ToFormEasy(visitReason.value, otherReasonText, phoneNumber, countryCode);
                    } else {
                        // Submit Step 4 responses to FormEasy with phone
                        await submitStep4ToFormEasy(visitReason.value, '', phoneNumber, countryCode);
                    }
                    
                    document.getElementById('step4Continue').disabled = false;
                    return true;
                
                default:
                    return true;
            }
        }

        // Convert blob to base64 (copied from index.html)
        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result.split(',')[1]); // Base64 part
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        // Send audio to GCP function and store result
        async function sendAudioToGCP(audioBlob) {
            try {
                const base64Audio = await blobToBase64(audioBlob);
                console.log('Sending audio to GCP function...');
                
                const response = await fetch('https://us-central1-detache-platform.cloudfunctions.net/analyzeSpeech', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        audioData: base64Audio
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('GCP response received:', data);
                
                // Store the result in localStorage
                localStorage.setItem('gcpAnalysisResult', JSON.stringify(data));
                console.log('Analysis result stored in localStorage');
                
                // Update status to show completion
                const statusEl = document.getElementById('recordingStatus');
                statusEl.textContent = '✅ Great recording! You can continue.';
                
            } catch (error) {
                console.error('Error sending audio to GCP:', error);
                // Even if GCP fails, store a fallback message so results page doesn't break
                const fallbackData = 'Analysis temporarily unavailable. Please try the assessment again.';
                localStorage.setItem('gcpAnalysisResult', JSON.stringify(fallbackData));
                
                const statusEl = document.getElementById('recordingStatus');
                statusEl.textContent = '✅ Great recording! You can continue.';
            }
        }

        // Audio quality analysis
        async function analyzeAudioQuality(audioBlob) {
            try {
                // Create audio context for analysis
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const arrayBuffer = await audioBlob.arrayBuffer();
                const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                
                // Check if audio has sufficient length (at least 3 seconds)
                if (audioBuffer.duration < 3) {
                    showRecordingError('Recording too short. Please record for at least 3 seconds.');
                    return;
                }
                
                // Analyze audio levels to detect if there's actual sound
                const channelData = audioBuffer.getChannelData(0);
                let sum = 0;
                let max = 0;
                
                for (let i = 0; i < channelData.length; i++) {
                    const sample = Math.abs(channelData[i]);
                    sum += sample;
                    max = Math.max(max, sample);
                }
                
                const averageLevel = sum / channelData.length;
                const dynamicRange = max;
                
                // Check for silence (very low audio levels)
                if (averageLevel < 0.001 || dynamicRange < 0.01) {
                    showRecordingError('No sound detected. Please speak louder and try recording again.');
                    return;
                }
                
                // Check for clipping (audio too loud)
                if (max > 0.95) {
                    showRecordingError('Audio is too loud and may be distorted. Please speak at normal volume and try again.');
                    return;
                }
                
                // Audio passed all checks
                hasValidAudio = true;
                document.getElementById('step2Continue').disabled = false;
                const statusEl = document.getElementById('recordingStatus');
                statusEl.textContent = '✅ Great recording! Analyzing...';
                statusEl.className = 'recording-status success';
                
                // Track successful recording
                gtag('event', 'recording_success', {
                    event_category: 'engagement',
                    event_label: 'assessment_step2'
                });
                
                // Send audio to GCP function and store result
                await sendAudioToGCP(audioBlob);
                
            } catch (error) {
                console.error('Error analyzing audio:', error);
                // If analysis fails, allow user to continue but log the error
                hasValidAudio = true;
                document.getElementById('step2Continue').disabled = false;
                document.getElementById('recordingStatus').textContent = '✅ Recording complete. You can continue.';
            }
        }
        
        // Show recording error and allow re-recording
        function showRecordingError(message) {
            hasValidAudio = false;
            document.getElementById('step2Continue').disabled = true;
            
            // Reset recording button to allow re-recording
            document.getElementById('recordBtn').textContent = '🎤 Try Recording Again';
            document.getElementById('recordBtn').style.background = '#FF9800';
            document.getElementById('recordBtn').disabled = false;
            
            // Show error message
            const statusEl = document.getElementById('recordingStatus');
            statusEl.textContent = `⚠️ ${message}`;
            statusEl.className = 'recording-status error';
            
            // Track recording failure
            gtag('event', 'recording_error', {
                event_category: 'engagement',
                event_label: 'assessment_step2',
                custom_parameters: {
                    error_message: message
                }
            });
        }

        // Recording functionality
        async function toggleRecording() {
            // If button shows "Try Recording Again", reset first
            if (document.getElementById('recordBtn').textContent.includes('Try Recording Again')) {
                resetRecording();
                return;
            }
            
            if (!isRecording) {
                await startRecording();
            } else {
                stopRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = () => {
                    audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    // Analyze audio quality before enabling continue button
                    analyzeAudioQuality(audioBlob);
                };
                
                mediaRecorder.start();
                isRecording = true;
                recordingTime = 0;
                
                document.getElementById('recordBtn').textContent = '⏹️ Stop Recording';
                document.getElementById('recordBtn').style.background = '#dc3545';
                
                recordingTimer = setInterval(() => {
                    recordingTime++;
                    const minutes = Math.floor(recordingTime / 60);
                    const seconds = recordingTime % 60;
                    document.getElementById('recordingStatus').textContent = 
                        `Recording time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
                
            } catch (error) {
                console.error('Error accessing microphone:', error);
                alert('Unable to access microphone. Please check permissions.');
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                isRecording = false;
                clearInterval(recordingTimer);
                
                // Show processing status while analyzing
                document.getElementById('recordBtn').textContent = '🔄 Processing...';
                document.getElementById('recordBtn').style.background = '#6c757d';
                document.getElementById('recordBtn').disabled = true;
                document.getElementById('recordingStatus').textContent = 'Analyzing audio quality...';
                document.getElementById('recordingStatus').style.color = '#666';
            }
        }
        
        // Reset recording state for re-recording
        function resetRecording() {
            audioChunks = [];
            audioBlob = null;
            hasValidAudio = false;
            recordingTime = 0;
            
            document.getElementById('recordBtn').textContent = '🎤 Click to Record';
            document.getElementById('recordBtn').style.background = '#000000';
            document.getElementById('recordBtn').disabled = false;
            document.getElementById('recordingStatus').textContent = 'Recording time: 0:00';
            document.getElementById('recordingStatus').style.color = '#666';
            document.getElementById('step2Continue').disabled = true;
        }

        // Processing animation
        function startProcessing() {
            let step = 1;
            const totalSteps = 3;
            
            const processInterval = setInterval(() => {
                if (step <= totalSteps) {
                    document.getElementById(`loading${step}`).classList.add('completed');
                    step++;
                } else {
                    clearInterval(processInterval);
                    startCountdown();
                }
            }, 1000);
        }

        // Submit final assessment completion to FormEasy
        async function submitFinalAssessment() {
            try {
                const email = localStorage.getItem('assessmentUserEmail');
                const troubleWords = document.querySelector('input[name="troubleWords"]:checked')?.value || 'not_answered';
                const ageGroup = document.querySelector('input[name="ageGroup"]:checked')?.value || 'not_answered';
                const visitReason = document.querySelector('input[name="visitReason"]:checked')?.value || 'not_answered';
                const otherReasonText = visitReason === 'other' ? document.getElementById('otherReason').value : '';
                const phoneNumber = document.getElementById('phoneNumber').value.trim();
                const countryCode = document.getElementById('countryCode').value;
                const fullPhoneNumber = phoneNumber && countryCode ? `${countryCode} ${phoneNumber}` : '';
                const gcpResult = localStorage.getItem('gcpAnalysisResult') || 'no_audio_analysis';
                
                await fetch('https://script.google.com/macros/s/AKfycbzKixpKPkJRuqIKj7p53JSholkMjkcvWrdlLh9Vv9kl1sX6wquSIdiTUqHg1NIG6GwkTA/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        email: email,
                        source: 'assessment_completion',
                        message: 'User completed full R-sound assessment',
                        trouble_words_response: troubleWords,
                        age_group: ageGroup,
                        found_on: visitReason === 'other' ? otherReasonText : visitReason,
                        found_on_type: visitReason,
                        other_reason_text: otherReasonText,
                        phone_number: fullPhoneNumber,
                        country_code: countryCode,
                        phone_number_raw: phoneNumber,
                        gcp_analysis_result: gcpResult,
                        assessment_completed: true,
                        completion_timestamp: new Date().toISOString(),
                        page: 'assessment.html'
                    })
                });
                
                // Track assessment completion
                gtag('event', 'assessment_completed', {
                    event_category: 'conversion',
                    event_label: 'full_assessment_flow'
                });
                
                console.log('Final assessment data submitted successfully');
            } catch (error) {
                console.error('Error submitting final assessment:', error);
                // Don't block redirect if submission fails
            }
        }
        
        function startCountdown() {
            let count = 5;
            const countdownInterval = setInterval(() => {
                count--;
                document.getElementById('countdown').textContent = count;
                
                if (count <= 0) {
                    clearInterval(countdownInterval);
                    // Submit final assessment data before redirect
                    submitFinalAssessment().finally(() => {
                        window.location.href = 'assessment-results.html';
                    });
                }
            }, 1000);
        }

        // Enable continue buttons when questions are answered
        document.addEventListener('change', function(e) {
            if (e.target.name === 'troubleWords' || e.target.name === 'ageGroup') {
                const troubleWords = document.querySelector('input[name="troubleWords"]:checked');
                const ageGroup = document.querySelector('input[name="ageGroup"]:checked');
                
                if (troubleWords && ageGroup) {
                    document.getElementById('step3Continue').disabled = false;
                } else {
                    document.getElementById('step3Continue').disabled = true;
                }
            }
            
            if (e.target.name === 'visitReason') {
                const visitReason = document.querySelector('input[name="visitReason"]:checked');
                const otherGroup = document.getElementById('otherReasonGroup');
                
                // Show/hide other input field
                if (visitReason && visitReason.value === 'other') {
                    otherGroup.style.display = 'block';
                    document.getElementById('step4Continue').disabled = true; // Wait for text input
                } else {
                    otherGroup.style.display = 'none';
                    if (visitReason) {
                        document.getElementById('step4Continue').disabled = false;
                    }
                }
            }
        });
        
        // Enable step 4 continue when other reason text is provided
        document.addEventListener('input', function(e) {
            if (e.target.id === 'otherReason') {
                const visitReason = document.querySelector('input[name="visitReason"]:checked');
                const otherText = e.target.value.trim();
                
                if (visitReason && visitReason.value === 'other' && otherText.length > 0) {
                    document.getElementById('step4Continue').disabled = false;
                } else if (visitReason && visitReason.value === 'other') {
                    document.getElementById('step4Continue').disabled = true;
                }
            }
        });

        // Track assessment events
        gtag('event', 'assessment_started', {
            event_category: 'engagement',
            event_label: 'multi_step_assessment'
        });
    </script>
</body>
</html>